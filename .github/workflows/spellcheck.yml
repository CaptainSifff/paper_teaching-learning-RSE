name: 'spellcheck'
on:
  workflow_dispatch:
  pull_request:
  push:
    branches:
      - main

jobs:
  spellcheck:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: "populate spellignore"
        run: |
          for file in "*.md"
          do
            # references
            grep -P -oh -e "(?<=@)[A-Za-z]+" $file >> .github/spellignore.txt
            # latex commands
            grep -P -oh -e "(?<=\\)[A-Za-z]+" $file >> .github/spellignore.txt
            # RSE compositions
             grep -P -oh -e "[\w-]*RSE[\w-]*" $file | sort | uniq >> .github/spellignore.txt
            # remove header
            sed -i '1,/---/{/^---$/,/^---$/d}' $file
          done
      - uses: matheus23/md-spellcheck-action@v4.2.2
        with:
          files-to-check: "*.md"
          files-to-exclude: "CONTRIBUTING.md\nREADME.md"
          words-to-ignore-file: .github/spellignore.txt
